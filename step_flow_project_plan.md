# План разработки проекта "Step Flow"

## 1. Общее видение и цели проекта

### 1.1. Видение
Создать инновационную мультиагентную систему "Step Flow" с интуитивным голосовым управлением и мощным конструктором workflow. Система должна позволять пользователям легко автоматизировать сложные процессы, создавать и настраивать ИИ-агентов, а также управлять ими через веб-интерфейс и PWA-приложение. "Step Flow" стремится стать лидером в области персонализированных ИИ-решений для автоматизации.

### 1.2. Ключевые цели
*   Разработать многофункциональную платформу с голосовым управлением (Speech-to-Speech).
*   Реализовать конструктор workflow на базе `react-flow` для создания и управления мультиагентными системами.
*   Обеспечить возможность генерации кастомных агентов, правил, инструкций.
*   Создать неоморфный черно-белый UI/UX с микроанимациями и уникальным анимированным прелоадером.
*   Обеспечить высокую производительность, масштабируемость и надежность системы.
*   Выпустить продукт в продакшн с командой специализированных ИИ-агентов.
*   Предоставить пользователям возможность создавать и управлять их личными экземплярами workflow в облачной инфраструктуре.

## 2. Детализированный стек технологий

### 2.1. Фронтенд
*   **Веб-приложение**: React, TypeScript.
*   **PWA/Мобильное приложение**: React Native, TypeScript.
*   **Стилизация и UI**: Неоморфный дизайн (черно-белая гамма), CSS-in-JS (например, Styled Components) или Tailwind CSS (адаптированный под AI aesthetic).
*   **Анимации**: Микроанимации (Framer Motion или React Spring), ASAP SVG для прелоадера.
*   **Управление состоянием**: Redux Toolkit, Zustand или Recoil.
*   **Конструктор Workflow**: `react-flow`.
*   **Сборка**: Webpack/Vite для React, Metro для React Native.

### 2.2. Бэкенд
*   **Язык/Фреймворк**: Python / FastAPI (для высокой производительности и асинхронности).
*   **База данных (основная)**: PostgreSQL (для реляционных данных, конфигураций агентов, workflow).
*   **База данных (кэш/сообщения)**: Redis (для кэширования, управления сессиями, возможно, как брокер сообщений для агентов).
*   **Аутентификация/Авторизация**: OAuth 2.0 / JWT.
*   **API**: RESTful API и/или GraphQL.

### 2.3. Голосовые технологии
*   **Speech-to-Text (STT)**: OpenAI Whisper.
*   **Text-to-Speech (TTS)**: ElevenLabs.

### 2.4. Мультиагентная система
*   **Ядро/Фреймворк**:
    *   **Вариант 1 (Рекомендуемый для старта)**: Langchain или Microsoft Autogen для быстрого прототипирования и использования готовых компонентов.
    *   **Вариант 2 (Долгосрочный/Кастомный)**: Разработка собственного легковесного ядра на Python для полного контроля и оптимизации под нужды проекта, если готовые решения окажутся недостаточно гибкими.
*   **Коммуникация между агентами**: Redis Pub/Sub или RabbitMQ/Kafka (если потребуется более сложная маршрутизация и гарантии доставки).
*   **Хранение конфигураций и инструкций агентов**: PostgreSQL или специализированные файлы конфигурации (YAML/JSON), управляемые через API.

### 2.5. DevOps
*   **Контейнеризация**: Docker.
*   **Оркестрация**: Kubernetes (для управления и масштабирования контейнеризированных приложений, включая воркфлоу клиентов).
*   **CI/CD**: GitHub Actions.
*   **Мониторинг**: Prometheus, Grafana.
*   **Логирование**: ELK Stack (Elasticsearch, Logstash, Kibana) или Grafana Loki.
*   **Инфраструктура как код (IaC)**: Terraform или Ansible (опционально, для управления облачной инфраструктурой).

## 3. Архитектура системы

### 3.1. Высокоуровневая архитектура

```mermaid
graph TD
    subgraph "Пользовательский интерфейс"
        UI_Web[Веб-приложение (React)]
        UI_PWA[PWA/Mobile App (React Native)]
    end

    subgraph "Бэкенд Система (FastAPI)"
        API_Gateway[API Gateway]
        AuthService[Сервис Аутентификации]
        WorkflowService[Сервис Управления Workflow]
        AgentService[Сервис Управления Агентами]
        VoiceService[Сервис Голосового Взаимодействия]
    end

    subgraph "Ядро Мультиагентной Системы"
        MAS_Core[Основное Ядро MAS]
        AgentOrchestrator[Оркестратор Агентов]
        AgentInstances[Экземпляры Агентов (контейнеры)]
    end

    subgraph "Хранилища Данных"
        DB_PostgreSQL[PostgreSQL]
        DB_Redis[Redis]
    end

    subgraph "Внешние Сервисы"
        Ext_Whisper[OpenAI Whisper API]
        Ext_ElevenLabs[ElevenLabs API]
        Ext_GoogleTasks[Jira  API]
    end

    UI_Web --> API_Gateway
    UI_PWA --> API_Gateway

    API_Gateway --> AuthService
    API_Gateway --> WorkflowService
    API_Gateway --> AgentService
    API_Gateway --> VoiceService

    VoiceService --> Ext_Whisper
    VoiceService --> Ext_ElevenLabs
    VoiceService --> MAS_Core

    WorkflowService --> MAS_Core
    WorkflowService --> DB_PostgreSQL
    AgentService --> MAS_Core
    AgentService --> DB_PostgreSQL

    MAS_Core --> AgentOrchestrator
    AgentOrchestrator --> AgentInstances
    MAS_Core --> DB_Redis # Для коммуникации/состояния

    AgentService --> Ext_GoogleTasks # Для TaskManager агента

    AuthService --> DB_PostgreSQL
```

### 3.2. Архитектура мультиагентного ядра

```mermaid
graph TD
    subgraph "Уровень API и Управления"
        API_AgentConfig[API Конфигурации Агентов]
        API_WorkflowExec[API Запуска/Управления Workflow]
    end

    subgraph "Ядро MAS"
        Core_Orchestrator[Оркестратор Ядра MAS]
        Core_LifecycleMgr[Менеджер Жизненного Цикла Агентов]
        Core_MsgBroker[Брокер Сообщений (Redis Pub/Sub или Kafka)]
        Core_StateMgr[Менеджер Состояний Workflow/Агентов (Redis/PostgreSQL)]
        Core_InstructionStore[Хранилище Инструкций/Правил (PostgreSQL/Файлы)]
    end

    subgraph "Исполнение Агентов (Контейнеры)"
        AgentContainer1[Контейнер с Агентом 1 (SF_Developer)]
        AgentContainer2[Контейнер с Агентом 2 (SF_QA)]
        AgentContainerN[Контейнер с Агентом N (...)]
    end

    API_AgentConfig --> Core_InstructionStore
    API_WorkflowExec --> Core_Orchestrator

    Core_Orchestrator --> Core_LifecycleMgr
    Core_Orchestrator --> Core_StateMgr
    Core_Orchestrator --> Core_MsgBroker

    Core_LifecycleMgr --> AgentContainer1
    Core_LifecycleMgr --> AgentContainer2
    Core_LifecycleMgr --> AgentContainerN

    AgentContainer1 -- Сообщения --> Core_MsgBroker
    AgentContainer2 -- Сообщения --> Core_MsgBroker
    AgentContainerN -- Сообщения --> Core_MsgBroker

    Core_MsgBroker -- Сообщения --> AgentContainer1
    Core_MsgBroker -- Сообщения --> AgentContainer2
    Core_MsgBroker -- Сообщения --> AgentContainerN

    AgentContainer1 -- Запросы состояния/инструкций --> Core_StateMgr
    AgentContainer1 -- Запросы состояния/инструкций --> Core_InstructionStore
```
*   **API Конфигурации Агентов**: Позволяет создавать, обновлять и управлять конфигурациями, инструкциями и правилами для различных типов агентов.
*   **API Запуска/Управления Workflow**: Принимает запросы на запуск workflow, передает их оркестратору ядра и отслеживает их выполнение.
*   **Оркестратор Ядра MAS**: Главный компонент, отвечающий за интерпретацию workflow, запуск необходимых агентов, передачу данных и координацию их работы.
*   **Менеджер Жизненного Цикла Агентов**: Отвечает за создание, запуск, остановку и мониторинг состояния контейнеров с агентами. Интегрируется с Kubernetes.
*   **Брокер Сообщений**: Обеспечивает асинхронную коммуникацию между агентами и ядром.
*   **Менеджер Состояний Workflow/Агентов**: Хранит и управляет текущим состоянием выполняемых workflow и отдельных агентов.
*   **Хранилище Инструкций/Правил**: Централизованное место для хранения инструкций, промптов и правил для всех агентов.
*   **Контейнеры с Агентами**: Изолированные окружения (Docker-контейнеры), в которых выполняются экземпляры агентов. Каждый агент имеет доступ к брокеру сообщений и, при необходимости, к хранилищу инструкций и состояний.

### 3.3. Архитектура данных
*   **PostgreSQL**:
    *   Информация о пользователях и их правах.
    *   Определения Workflow (структура, шаги, связи).
    *   Конфигурации и инструкции для шаблонов агентов.
    *   История выполнения Workflow.
    *   Логи аудита и действий пользователей.
    *   Метаданные проекта.
*   **Redis**:
    *   Кэш сессий пользователей.
    *   Кэш часто запрашиваемых данных.
    *   Очереди сообщений для асинхронной коммуникации между агентами (если используется Redis Pub/Sub).
    *   Хранение временных состояний активных Workflow и агентов.

## 4. Команда ИИ-агентов для "Step Flow"

### 4.1. Общий подход и рационализация
Предложенный пользователем список агентов обширен и покрывает многие аспекты. Для эффективной работы и избежания излишней гранулярности, некоторые роли будут объединены или уточнены. Основные существующие роли (`Orchestrator`, `Code`, `Architect`, `QA`, `ProjectManager`) будут адаптированы и дополнены специфичными для "Step Flow" агентами. Новые роли будут иметь префикс `SF_` (Step Flow).

### 4.2. Описание ролей агентов

#### 4.2.1. `SF_Orchestrator` (Адаптация существующего `Orchestrator`)
*   **Обязанности**:
    *   Главный координатор выполнения задач в рамках проекта "Step Flow".
    *   Декомпозиция высокоуровневых задач от `SF_ProjectManager` или пользователя.
    *   Делегирование подзадач специализированным `SF_` агентам.
    *   Контроль общего прогресса разработки "Step Flow", взаимодействие с `SF_PipelineAdmin`.
    *   Управление зависимостями между задачами разработки.
*   **Инструменты**: Доступ к таск-трекеру, базе знаний проекта, конфигурациям других агентов.
*   **Взаимодействие**: `SF_ProjectManager`, `SF_Architect`, все `SF_Developer` агенты, `SF_QA`, `SF_PipelineAdmin`.

#### 4.2.2. `SF_ProjectManager` (Адаптация существующего `ProjectManager`)
*   **Обязанности**:
    *   Управление бэклогом проекта "Step Flow".
    *   Приоритизация задач совместно с `SF_Architect` и стейкхолдерами.
    *   Отслеживание прогресса по этапам Roadmap.
    *   Коммуникация с пользователем (для сбора требований, демонстраций).
    *   Планирование спринтов и релизов.
    *   Взаимодействие с `SF_TaskManager` для синхронизации с Jira .
*   **Инструменты**: Таск-трекер (Jira), инструменты планирования, Jira  API (через `SF_TaskManager`).
*   **Взаимодействие**: `SF_Orchestrator`, `SF_Architect`, `SF_TaskManager`, пользователь.

#### 4.2.3. `SF_Architect` (Эта роль, то есть я)
*   **Обязанности**:
    *   Разработка и поддержка архитектуры системы "Step Flow".
    *   Выбор и обновление технологического стека.
    *   Проектирование взаимодействия компонентов системы.
    *   Создание и обновление архитектурной документации (включая этот план).
    *   Ревью кода на соответствие архитектуре.
    *   Консультирование других агентов по архитектурным вопросам.
*   **Инструменты**: Средства моделирования (Mermaid), документация, доступ к кодовой базе.
*   **Взаимодействие**: `SF_Orchestrator`, `SF_ProjectManager`, `SF_LeadDeveloper`, все `SF_Developer` агенты.

#### 4.2.4. `SF_LeadDeveloper` (Новая роль, детализация `TeamLead`)
*   **Обязанности**:
    *   Техническое руководство командой `SF_Developer` агентов.
    *   Помощь в решении сложных технических задач.
    *   Контроль качества кода, проведение код-ревью.
    *   Менторство и развитие `SF_Developer` агентов.
    *   Обеспечение соблюдения гайдлайнов по разработке.
    *   Исследование новых технологий и подходов для улучшения процесса разработки.
*   **Инструменты**: IDE, Git, инструменты для код-ревью, доступ к таск-трекеру.
*   **Взаимодействие**: `SF_Architect`, `SF_Orchestrator`, все `SF_Developer` агенты.

#### 4.2.5. `SF_Developer (Frontend - Web)` (Адаптация `Code` для веб-фронтенда)
*   **Обязанности**:
    *   Разработка веб-интерфейса "Step Flow" на React и TypeScript.
    *   Реализация неоморфного дизайна и микроанимаций.
    *   Создание компонентов для конструктора workflow (`react-flow`).
    *   Написание unit и интеграционных тестов.
*   **Инструменты**: React, TypeScript, `react-flow`, Styled Components/Tailwind, Framer Motion/React Spring, Jest, React Testing Library.
*   **Взаимодействие**: `SF_LeadDeveloper`, `SF_UI_Designer`, `SF_Developer (Backend)`, `SF_QA`.

#### 4.2.6. `SF_Developer (Frontend - PWA/Mobile)` (Адаптация `Code` для PWA/Mobile)
*   **Обязанности**:
    *   Разработка PWA и мобильного приложения "Step Flow" на React Native и TypeScript.
    *   Адаптация неоморфного дизайна и анимаций для мобильных платформ.
    *   Интеграция с нативными функциями устройства (если потребуется).
    *   Написание unit и интеграционных тестов.
*   **Инструменты**: React Native, TypeScript, Styled Components/Tailwind (адаптированный), Framer Motion/React Spring, Jest, React Native Testing Library.
*   **Взаимодействие**: `SF_LeadDeveloper`, `SF_UI_Designer`, `SF_Developer (Backend)`, `SF_QA`.

#### 4.2.7. `SF_Developer (Backend)` (Адаптация `Code` для бэкенда)
*   **Обязанности**:
    *   Разработка бэкенд-сервисов на Python/FastAPI.
    *   Проектирование и реализация API.
    *   Работа с базами данных PostgreSQL и Redis.
    *   Интеграция с голосовыми сервисами (Whisper, ElevenLabs).
    *   Разработка логики для ядра мультиагентной системы.
    *   Написание unit и интеграционных тестов.
*   **Инструменты**: Python, FastAPI, SQLAlchemy/AsyncPG, Pytest.
*   **Взаимодействие**: `SF_LeadDeveloper`, `SF_Developer (Frontend - Web)`, `SF_Developer (Frontend - PWA/Mobile)`, `SF_QA`, `SF_DevOps`.

#### 4.2.8. `SF_UI_Designer` (Новая роль)
*   **Обязанности**:
    *   Проектирование пользовательского интерфейса (UI) и пользовательского опыта (UX) для веб и PWA/мобильных приложений.
    *   Создание макетов, прототипов в неоморфном стиле (черно-белая гамма).
    *   Разработка концепции микроанимаций и прелоадера (ASAP SVG).
    *   Подготовка UI-кита и детальных гайдлайнов по дизайну, являющихся основой для документа [`./.roo/roocode_rules.yaml`](./.roo/roocode_rules.yaml).
    *   Обеспечение строгого следования всеми вовлеченными агентами (`SF_Developer (Frontend - Web)`, `SF_Developer (Frontend - PWA/Mobile)`) правилам, изложенным в [`./.roo/roocode_rules.yaml`](./.roo/roocode_rules.yaml) (секция `SF_Developer_Frontend`).
    *   Проведение ревью UI-компонентов, разработанных `SF_Developer` агентами, на предмет соответствия гайдлайнам из [`./.roo/roocode_rules.yaml`](./.roo/roocode_rules.yaml).
    *   Тесное взаимодействие с фронтенд-разработчиками.
*   **Инструменты**: Figma/Sketch/Adobe XD, инструменты для создания SVG-анимаций.
*   **Взаимодействие**: `SF_ProjectManager`, `SF_Developer (Frontend - Web)`, `SF_Developer (Frontend - PWA/Mobile)`, `SF_QA`.

#### 4.2.9. `SF_QA` (Адаптация существующего `QA`)
*   **Обязанности**:
    *   Разработка и выполнение тест-кейсов для всех компонентов "Step Flow".
    *   Функциональное, регрессионное, UI/UX, нагрузочное тестирование.
    *   Автоматизация тестирования (Selenium, Cypress, Appium, Detox).
    *   Репортинг багов и контроль их исправления.
    *   Обеспечение качества на всех этапах разработки.
    *   Проверка соответствия разработанного UI/UX детальным гайдлайнам, изложенным в [`./.roo/roocode_rules.yaml`](./.roo/roocode_rules.yaml), включая правила для `SF_UI_Designer` и `SF_Developer_Frontend`.
*   **Инструменты**: Системы управления тестированием, фреймворки автоматизации, инструменты для API-тестирования (Postman).
*   **Взаимодействие**: Все `SF_Developer` агенты, `SF_UI_Designer`, `SF_ProjectManager`, `SF_Orchestrator`.

#### 4.2.10. `SF_DevOps` (Новая роль, объединяет `DevOps` и `Deployment` агентов)
*   **Обязанности**:
    *   Настройка и поддержка CI/CD пайплайнов (GitHub Actions).
    *   Управление инфраструктурой (Docker, Kubernetes).
    *   Мониторинг и логирование системы.
    *   Автоматизация процессов сборки, тестирования и деплоя.
    *   Обеспечение безопасности и отказоустойчивости инфраструктуры.
    *   Управление репозиториями GIT, версионированием.
*   **Инструменты**: Docker, Kubernetes, GitHub Actions, Prometheus, Grafana, ELK/Loki, Terraform/Ansible, Git.
*   **Взаимодействие**: Все `SF_Developer` агенты, `SF_Architect`, `SF_QA`.

#### 4.2.11. `SF_DataScientist` (Новая роль)
*   **Обязанности**:
    *   Анализ данных о работе мультиагентной системы и поведении пользователей.
    *   Разработка моделей для улучшения эффективности агентов (если потребуется).
    *   Построение дашбордов для отслеживания ключевых метрик.
    *   Исследование возможностей применения ML для расширения функционала "Step Flow".
*   **Инструменты**: Python, Pandas, Scikit-learn, TensorFlow/PyTorch, Jupyter Notebooks, SQL.
*   **Взаимодействие**: `SF_ProjectManager`, `SF_Architect`, `SF_Developer (Backend)`.

#### 4.2.12. `SF_ContentManager` (Новая роль)
*   **Обязанности**:
    *   Создание и поддержка текстового контента для интерфейсов (веб, PWA).
    *   Подготовка текстов для стандартных ответов голосового ассистента.
    *   Управление ссылками и информационными материалами в системе.
    *   Обеспечение консистентности и качества текстовой информации.
*   **Инструменты**: Текстовые редакторы, системы управления контентом (если применимо).
*   **Взаимодействие**: `SF_UI_Designer`, `SF_Developer (Frontend - Web)`, `SF_Developer (Frontend - PWA/Mobile)`, `SF_DocWriter`.

#### 4.2.13. `SF_DocWriter` (Новая роль, ИИ писатель документации)
*   **Обязанности**:
    *   Создание и поддержка технической и пользовательской документации на русском и английском языках.
    *   Документирование архитектуры, API, компонентов системы, файлов, констант, переменных.
    *   Подготовка гайдов для пользователей и разработчиков.
    *   Автоматизация генерации документации из кода (docstrings).
*   **Инструменты**: MkDocs/Sphinx/Docusaurus, Git, инструменты для работы с docstrings.
*   **Взаимодействие**: `SF_Architect`, все `SF_Developer` агенты, `SF_QA`, `SF_ContentManager`.

#### 4.2.14. `SF_VoiceInteractionManager` (Новая роль, часть голосового ассистента)
*   **Обязанности**:
    *   Обработка голосовых команд пользователя.
    *   Интеграция с Whisper (STT) и ElevenLabs (TTS).
    *   Управление диалогом с пользователем.
    *   Преобразование голосовых команд в действия для мультиагентной системы.
    *   Формирование голосовых ответов.
*   **Инструменты**: API Whisper, API ElevenLabs, библиотеки для управления диалогами.
*   **Взаимодействие**: `SF_Developer (Backend)` (для интеграции), ядро MAS.

#### 4.2.15. `SF_WorkflowBuilderAgent` (Новая роль, часть конструктора workflow)
*   **Обязанности**:
    *   Предоставление интерфейса и логики для создания и редактирования workflow в `react-flow`.
    *   Валидация создаваемых workflow.
    *   Сохранение и загрузка определений workflow.
    *   Взаимодействие с бэкендом для управления workflow.
    *   Генерация конфигураций для мультиагентного ядра на основе визуального представления workflow.
*   **Инструменты**: `react-flow`, TypeScript.
*   **Взаимодействие**: `SF_Developer (Frontend - Web)`, `SF_Developer (Backend)` (для API).

#### 4.2.16. `SF_TaskManager (Jira  Integrator)` (Новая роль)
*   **Обязанности**:
    *   Интеграция с Jira  API.
    *   Создание, обновление, удаление задач и подзадач в Jira  на основе информации из внутреннего таск-трекера или команд `SF_ProjectManager`.
    *   Синхронизация статусов и прогресса выполнения задач.
*   **Инструменты**: Jira  API, Python/FastAPI (если это бэкенд-агент) или JavaScript (если это клиентский агент).
*   **Взаимодействие**: `SF_ProjectManager`, `SF_Orchestrator`.

#### 4.2.17. `SF_PipelineAdmin` (Новая роль, ИИ админ пайплайна)
*   **Обязанности**:
    *   Мониторинг соблюдения пайплайна разработки всеми агентами.
    *   Проверка выполнения инструкций и гайдлайнов.
    *   Уведомление `SF_Orchestrator` или `SF_ProjectManager` о нарушениях или отклонениях.
    *   Автоматизация рутинных проверок в рамках пайплайна.
*   **Инструменты**: Доступ к логам CI/CD, таск-трекеру, системе контроля версий.
*   **Взаимодействие**: `SF_Orchestrator`, `SF_ProjectManager`, `SF_DevOps`.

#### 4.2.18. `SF_ScrumMaster` (Новая роль)
*   **Обязанности**:
    *   Фасилитация всех Scrum-церемоний (Планирование Спринта, Ежедневный Скрам, Обзор Спринта, Ретроспектива Спринта).
    *   Обучение команды и `SF_ProjectManager` (в роли Product Owner) принципам и практикам Scrum.
    *   Помощь команде в самоорганизации и устранении препятствий.
    *   Защита команды от внешних отвлекающих факторов.
    *   Отслеживание ключевых метрик команды (скорость, выгорание и т.д.).
*   **Инструменты**: Таск-трекер (Jira), инструменты для фасилитации митингов, Scrum Guide.
*   **Взаимодействие**: Все `SF_Developer` агенты, `SF_ProjectManager` (как Product Owner), `SF_Orchestrator`, `SF_LeadDeveloper`.

#### 4.2.19. `SF_Research` (Новая роль)
*   **Обязанности**:
    *   Проведение исследований по запросам от других агентов или на основе стратегических целей проекта.
    *   Анализ новых технологий, фреймворков, инструментов, которые могут быть полезны для "Step Flow".
    *   Сбор и анализ данных о конкурентах, рынке, пользовательских трендах.
    *   Подготовка отчетов и презентаций по результатам исследований.
    *   Помощь в формировании требований на основе исследовательских данных.
*   **Инструменты**: Доступ в интернет, специализированные базы данных и аналитические инструменты (если применимо), инструменты для создания отчетов.
*   **Взаимодействие**: `SF_Architect`, `SF_ProjectManager`, `SF_LeadDeveloper`, `SF_DataScientist`, `SF_Orchestrator`.

### 4.3. Конфигурация агентов
*   Для каждой новой или адаптированной роли `SF_...` будут созданы JSON-файлы конфигурации в директории `step_flow/.roo/modes/`.
*   Эти файлы будут содержать:
    *   `slug` (например, `sf_developer_backend`).
    *   `name` (например, "SF: Backend Developer").
    *   `model` (указать используемую LLM).
    *   `role` (подробное описание роли, как выше).
    *   `custom_instructions` (специфичные инструкции для агента, включая его инструменты, ограничения, стиль общения, если отличается от глобального).
    *   `allowed_file_patterns` (если есть ограничения на редактируемые файлы).

## 5. План разработки (Roadmap)

### 5.1. Этап 1: MVP (Минимально жизнеспособный продукт) - (Примерно 3-4 месяца)
*   **Цели**: Базовый функционал голосового управления и конструктора workflow.
*   **Ключевые фичи**:
    *   Веб-приложение: Аутентификация, главный дашборд.
    *   Бэкенд: Базовые API для управления пользователями и workflow.
    *   Голосовое управление: Интеграция Whisper и ElevenLabs для простого диалога (например, "создай новый workflow", "добавь агента").
    *   Конструктор Workflow: Базовый интерфейс на `react-flow` для создания workflow из 2-3 предустановленных типов агентов.
    *   Мультиагентное ядро: Запуск простых workflow с 2-3 агентами.
    *   DevOps: Базовый CI/CD для бэкенда и фронтенда.
    *   Основные агенты: `SF_Architect`, `SF_ProjectManager`, `SF_Orchestrator`, `SF_Developer (Backend)`, `SF_Developer (Frontend - Web)`, `SF_QA`, `SF_DevOps`, `SF_ScrumMaster`.

### 5.2. Этап 2: Alpha (Примерно 3-4 месяца после MVP)
*   **Цели**: Расширение функционала, PWA, кастомные агенты.
*   **Ключевые фичи**:
    *   PWA: Первая версия на React Native с основным функционалом веб-приложения.
    *   Голосовое управление: Более сложные диалоги, управление параметрами агентов голосом.
    *   Конструктор Workflow: Возможность создания кастомных агентов (определение инструкций, правил), больше инструментов и сервисов для подключения.
    *   Мультиагентное ядро: Поддержка кастомных агентов, более сложные пайплайны.
    *   Неоморфный UI: Полная реализация дизайна с микроанимациями и прелоадером.
    *   Интеграция с Jira  (`SF_TaskManager`).
    *   Расширение команды агентов: `SF_UI_Designer`, `SF_DocWriter`, `SF_ContentManager`, `SF_LeadDeveloper`, `SF_Developer (Frontend - PWA/Mobile)`, `SF_Research`.

### 5.3. Этап 3: Beta (Примерно 2-3 месяца после Alpha)
*   **Цели**: Стабилизация, оптимизация, сбор обратной связи.
*   **Ключевые фичи**:
    *   Масштабирование: Оптимизация производительности бэкенда и мультиагентного ядра.
    *   Безопасность: Аудит безопасности, усиление защиты.
    *   Тестирование: Расширенное нагрузочное и пользовательское тестирование.
    *   Документация: Полная пользовательская и техническая документация.
    *   Клиентские воркфлоу: Реализация механизма создания и изоляции персональных воркфлоу для клиентов в облаке (Kubernetes).
    *   Агенты: `SF_DataScientist` (начало сбора и анализа данных), `SF_PipelineAdmin`.

### 5.4. Этап 4: Release (Примерно 1-2 месяца после Beta)
*   **Цели**: Публичный запуск.
*   **Ключевые фичи**:
    *   Исправление всех критических и мажорных багов.
    *   Маркетинговые материалы.
    *   Подготовка поддержки пользователей.
    *   Финальная полировка UI/UX.

## 6. Предлагаемая структура директорий проекта

```
/Users/bat/Documents/AIMultiAgent/
├── .git/
├── .roo/                     # Глобальные конфигурации и документация Roo
│   ├── modes/                # Глобальные режимы агентов
│   ├── development_guidelines.md
│   ├── pipeline.md
│   └── roles.md
├── step_flow/                # Корневая папка проекта "Step Flow"
│   ├── .roo/                 # Специфичные для "Step Flow" конфигурации Roo
│   │   ├── modes/            # Режимы агентов для "Step Flow" (SF_...)
│   │   ├── roles.md          # Описание ролей SF_... агентов
│   │   └── development_guidelines.md # Специфичные гайдлайны
│   ├── backend/              # Бэкенд на FastAPI
│   │   ├── app/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── requirements.txt
│   ├── frontend_web/         # Веб-приложение на React
│   │   ├── public/
│   │   ├── src/
│   │   ├── Dockerfile
│   │   └── package.json
│   ├── frontend_pwa/         # PWA/Мобильное приложение на React Native
│   │   ├── src/
│   │   ├── ios/
│   │   ├── android/
│   │   └── package.json
│   ├── docs/                 # Документация проекта (MkDocs, Sphinx)
│   ├── devops/               # Конфигурации DevOps
│   │   ├── kubernetes/       # Манифесты Kubernetes
│   │   ├── CI/               # Скрипты и конфигурации GitHub Actions
│   │   └── grafana_dashboards/ # Дашборды Grafana
│   ├── shared_types/         # Общие TypeScript типы для фронтенда и бэкенда (опционально)
│   └── step_flow_project_plan.md # Этот документ
└── vars.evn
```

## 7. Пайплайн разработки и взаимодействия агентов в "Step Flow"

Данный пайплайн описывает ключевые этапы разработки и роли агентов в проекте "Step Flow", обеспечивая четкое распределение ответственности и эффективное взаимодействие.

### 7.1. Ключевые принципы
*   **Итеративность и инкрементальность**: Разработка ведется короткими циклами (спринтами) с регулярной поставкой работающего продукта.
*   **Следование Scrum-фреймворку**: `SF_ScrumMaster` обеспечивает соблюдение практик Scrum.
*   **Четкое разделение ответственности**: Каждый агент имеет свою зону ответственности.
*   **Прозрачность**: Все задачи и их прогресс отслеживаются в Jira (через `SF_TaskManager`).
*   **Качество**: `SF_QA` обеспечивает контроль качества на всех этапах.
*   **Соблюдение архитектуры**: `SF_Architect` контролирует соответствие решений архитектуре проекта.
*   **Автоматизация**: `SF_DevOps` автоматизирует процессы сборки, тестирования и развертывания.

### 7.2. Этапы пайплайна и роли агентов

#### 7.2.1. Инициация и Планирование (Уровень `SF_ProjectManager` и `SF_Architect`)
1.  **Формирование видения и требований**:
    *   `SF_ProjectManager` (в роли Product Owner) собирает требования от стейкхолдеров/пользователя, определяет бизнес-цели.
    *   `SF_Architect` участвует в определении технических требований и ограничений.
    *   `SF_Research` (при необходимости) проводит предварительные исследования рынка, технологий, конкурентов. Результаты передаются `SF_ProjectManager` и `SF_Architect`.
2.  **Определение Roadmap и MVP**:
    *   `SF_ProjectManager` и `SF_Architect` совместно формируют долгосрочный Roadmap и определяют состав MVP.
3.  **Создание и Приоритизация Бэклога Продукта**:
    *   `SF_ProjectManager` создает и ведет Бэклог Продукта в Jira (через `SF_TaskManager`). Задачи описываются в виде User Stories с критериями приемки.
    *   Приоритеты в бэклоге определяются `SF_ProjectManager` по согласованию с `SF_Architect`.

#### 7.2.2. Планирование Спринта (Командная работа под руководством `SF_ScrumMaster`)
1.  **Мероприятие "Планирование Спринта"**:
    *   `SF_ScrumMaster` фасилитирует встречу.
    *   `SF_ProjectManager` представляет наиболее приоритетные элементы Бэклога Продукта.
    *   Команда разработки (`SF_LeadDeveloper`, `SF_Developer` агенты, `SF_QA`, `SF_UI_Designer` при необходимости) обсуждает и выбирает задачи на спринт, формируя Бэклог Спринта.
    *   `SF_Orchestrator` помогает в декомпозиции выбранных задач на более мелкие подзадачи для `SF_Developer` агентов, если это необходимо на данном этапе.
    *   Задачи в Бэклоге Спринта также заносятся в Jira.

#### 7.2.3. Разработка и Ежедневная координация (Цикл Спринта)
1.  **Ежедневный Скрам (Daily Scrum)**:
    *   `SF_ScrumMaster` фасилитирует короткую ежедневную встречу команды разработки для синхронизации и выявления препятствий.
2.  **Исследования (при необходимости)**:
    *   В ходе спринта `SF_Developer` агенты или `SF_Architect` могут инициировать запросы к `SF_Research` для получения специфической информации, необходимой для решения текущих задач.
3.  **Дизайн UI/UX**:
    *   `SF_UI_Designer` разрабатывает макеты и прототипы для задач, требующих UI. Передает их `SF_Developer (Frontend)` агентам.
4.  **Разработка (Кодирование)**:
    *   `SF_Developer` агенты (Frontend Web, Frontend PWA/Mobile, Backend) реализуют функционал согласно задачам из Бэклога Спринта.
    *   `SF_LeadDeveloper` оказывает техническую поддержку, проводит предварительные ревью, следит за качеством кода и соблюдением гайдлайнов.
5.  **Написание тестов**:
    *   `SF_Developer` агенты пишут unit-тесты.
    *   `SF_QA` разрабатывает тест-кейсы (функциональные, интеграционные, UI/UX и т.д.) для разрабатываемого функционала.
6.  **Управление кодом и CI/CD**:
    *   `SF_DevOps` обеспечивает работу CI/CD пайплайнов. Коммиты от `SF_Developer` агентов триггерят автоматическую сборку и прогон тестов.

#### 7.2.4. Тестирование и Обеспечение Качества
1.  **Тестирование**:
    *   `SF_QA` проводит тестирование разработанного функционала согласно подготовленным тест-кейсам. Это включает:
        *   Функциональное тестирование.
        *   Тестирование UI/UX (взаимодействие с `SF_UI_Designer`).
        *   Тестирование API (для бэкенда).
        *   Интеграционное тестирование компонентов.
        *   Специфичное тестирование: голосового интерфейса, PWA/Mobile, мультиагентных сценариев.
2.  **Репортинг багов**:
    *   Обнаруженные баги `SF_QA` заносит в Jira (через `SF_TaskManager`) с четким описанием и шагами воспроизведения.
3.  **Исправление багов**:
    *   `SF_Developer` агенты исправляют баги, `SF_QA` проводит повторное тестирование.

#### 7.2.5. Ревью Кода и Архитектуры
1.  **Код-ревью**:
    *   `SF_LeadDeveloper` и/или другие `SF_Developer` агенты проводят формальное код-ревью завершенных задач.
2.  **Архитектурное ревью**:
    *   `SF_Architect` проводит ревью на соответствие архитектуре для критически важных или сложных компонентов.

#### 7.2.6. Обзор Спринта (Sprint Review)
1.  **Мероприятие "Обзор Спринта"**:
    *   `SF_ScrumMaster` фасилитирует встречу.
    *   Команда разработки демонстрирует инкремент продукта, выполненный за спринт, `SF_ProjectManager` и другим стейкхолдерам.
    *   `SF_ProjectManager` собирает обратную связь, которая может повлиять на Бэклог Продукта.

#### 7.2.7. Ретроспектива Спринта (Sprint Retrospective)
1.  **Мероприятие "Ретроспектива Спринта"**:
    *   `SF_ScrumMaster` фасилитирует встречу команды (включая `SF_ProjectManager` как часть команды Scrum).
    *   Команда обсуждает, что прошло хорошо, что можно улучшить в процессах, инструментах или взаимодействии. Результаты ретроспективы используются для улучшения работы в следующих спринтах.

#### 7.2.8. Релиз и Развертывание
1.  **Подготовка к релизу**:
    *   После нескольких успешных спринтов и достижения целей релиза (например, MVP, Alpha), `SF_ProjectManager` инициирует подготовку к релизу.
    *   `SF_QA` проводит финальное регрессионное и, при необходимости, нагрузочное тестирование.
    *   `SF_DocWriter` финализирует пользовательскую и техническую документацию для релиза.
    *   `SF_ContentManager` готовит релизные тексты и материалы.
2.  **Развертывание (Деплой)**:
    *   `SF_DevOps` управляет процессом развертывания на staging и production окружения через CI/CD пайплайны.

### 7.3. Мониторинг и Поддержка Пайплайна
*   **`SF_PipelineAdmin`**:
    *   Постоянно мониторит соблюдение описанного пайплайна всеми агентами.
    *   Проверяет выполнение инструкций, гайдлайнов, корректность использования Jira.
    *   Уведомляет `SF_Orchestrator`, `SF_ProjectManager` и `SF_ScrumMaster` о выявленных нарушениях или системных проблемах в пайплайне.
    *   Предлагает улучшения для автоматизации и оптимизации пайплайна.

### 7.4. Управление конфигурациями агентов
*   `SF_Architect` и `SF_LeadDeveloper` отвечают за актуальность и корректность конфигурационных файлов агентов (в `step_flow/.roo/modes/`).
*   Изменения в конфигурациях проходят через стандартный процесс код-ревью и версионирования.

## 8. Предложения и замечания

### 8.1. Потенциальные риски
*   **Сложность интеграции**: Большое количество технологий (голосовые, мультиагентные, React Native, Kubernetes) может привести к сложностям при интеграции.
*   **Производительность голосовых сервисов**: Задержки в работе Whisper или ElevenLabs могут негативно сказаться на UX.
*   **Качество распознавания и синтеза речи**: Зависимость от внешних сервисов STT/TTS.
*   **Сложность отладки мультиагентных систем**: Отладка взаимодействий между множеством агентов может быть нетривиальной.
*   **Подбор и обучение команды ИИ-агентов**: Настройка и обучение такого большого количества специализированных агентов потребует времени и ресурсов.
*   **Неоморфный дизайн**: Хотя и эффектный, может быть сложен в реализации и обеспечении доступности (accessibility).
*   **Управление облачной инфраструктурой**: Kubernetes требует экспертизы для настройки и поддержки.

### 8.2. Дополнительные предложения
*   **Итеративная разработка голосового ассистента**: Начать с ограниченного набора команд и постепенно расширять его возможности.
*   **Модульная архитектура мультиагентного ядра**: Спроектировать ядро так, чтобы можно было легко добавлять новые типы агентов и источники данных.
*   **Фокус на пользовательском опыте (UX)**: Особенно для конструктора workflow и голосового управления. Проводить регулярное UX-тестирование.
*   **Создание "песочницы" для разработчиков workflow**: Место, где пользователи смогут безопасно экспериментировать с созданием и тестированием своих агентов и workflow.
*   **Рассмотреть использование feature flags**: Для постепенного выкатывания новых фич и A/B тестирования.

## 9. Обновление существующей документации и конфигураций

### 9.1. Обновление глобальных документов (в `.roo/`)
*   [`./.roo/roles.md`](./.roo/roles.md): Можно добавить общие принципы именования проектно-специфичных ролей (например, префикс `PROJECT_`).
*   [`./.roo/pipeline.md`](./.roo/pipeline.md): Можно добавить секцию о том, как адаптировать пайплайн для крупных подпроектов типа "Step Flow".

### 9.2. Создание специфичных документов для "Step Flow" (в `step_flow/.roo/`)
*   **`step_flow/.roo/roles.md`**: Детальное описание всех `SF_...` агентов, их обязанностей, инструментов и взаимодействий (как в разделе 4 этого плана).
*   **`step_flow/.roo/development_guidelines.md`**:
    *   Специфичные гайдлайны для React Native (стиль кода, работа с нативными модулями).
    *   Гайдлайны для FastAPI (структура проекта, работа с Pydantic моделями, асинхронное программирование).
    *   Правила именования компонентов в неоморфном UI.
    *   Гайдлайны по написанию инструкций для ИИ-агентов.
*   **`step_flow/.roo/modes/`**: JSON файлы конфигураций для каждого `SF_...` агента.
